<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:fn="http://www.w3.org/2005/xpath-functions">
  <head>
    <title>jMock - How Mocked Methods are Dispatched</title>
    <link media="screen" rel="stylesheet" type="text/css" href="./jmock.css"/>
    <link media="print" rel="stylesheet" type="text/css" href="./print.css"/>
    <link rel="icon" type="image/png" href="./icon.png"/>
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <script type="text/javascript" src="prefs.js">
      
    </script>
  </head>
  <body onload="restorePreferredTestFramework()">
    <div id="banner">
      <a href="./index.html">
        <img id="logo" src="logo.png" alt="jMock"/>
      </a>
    </div>
    <div id="center" class="Content">
      <div id="content">
        <h1>How Mocked Methods are Dispatched</h1>
        <p>When a method is invoked on a mock object, the Mockery searches through
its expectations from oldest to newest to find one that matches the
invocation. After the invocation, the matching expectation might stop
matching further invocations. For example, an <code>one</code> expectation
only matches once and will be ignored on future invocations while an
<code>atLeast(1)</code> expectation will always be matched against
invocations.</p>
        <p>This scheme allows you to set up different expectations for the same
method with different action per invocation. However, it's better to use the
<code>onConsecutiveCalls</code> method to do this, as described below.</p>
        <p>However, there are some possible "gotchas" caused by this scheme:</p>
        <ul>
  <li>if you create an "allowing" or "ignoring" or "atLeast(n)" expectation
    before any other expectations that match the same invocations, the
    earlier expectation will always override the later expectation and the
    later expectation will never be triggered.</li>
  <li>if you create an expectation and then a stub for the same method, the
    expectation will match, and when it stops matching the stub will be used
    instead, possibly masking test failures.</li>
</ul>
        <p>The best thing to do is <em>not</em> set up multiple expectations for the
same method with exactly the same matchers. Instead, use the
<tt><code>onConsecutiveCalls</code></tt> method to create multiple actions
for a method. For example:</p>
        <pre class="Java Source">atLeast(1).of (anObject).doSomething();
   will(onConsecutiveCalls(
       returnValue(10),
       returnValue(20),
       throwException(new IOException("no more stuff"))));</pre>
        <p>If you want to specify more complex ordering constraints use the <a href="sequences.html">sequences</a><sup class="LinkFootnoteRef">1</sup> or <a href="states.html">state
machines</a><sup class="LinkFootnoteRef">2</sup> to explicitly define a total or partial ordering of
invocations.</p>
      </div>
      <div class="LinkFootnotes">
        <p class="LinkFootnotesHeader">Links:</p>
        <p>1.
	  				sequences:
	  				
	  				http://www.jmock.org/sequences.html</p>
        <p>2.
	  				state
machines:
	  				
	  				http://www.jmock.org/states.html</p>
      </div>
    </div>
    <div id="navigation">
      <div class="MenuGroup">
        <h1>
          <a href="download.html">Software</a>
        </h1>
        <versions xmlns="">
  <h2 xmlns="http://www.w3.org/1999/xhtml">jMock 2 (Java 1.5+)</h2><ul xmlns="http://www.w3.org/1999/xhtml"><li><a href="./download.html">Stable: 2.6.0</a></li></ul>
  <h2 xmlns="http://www.w3.org/1999/xhtml">jMock 1 (Java 1.3+)</h2><ul xmlns="http://www.w3.org/1999/xhtml"><li><a href="./download.html">Stable: 1.2.0</a></li></ul>
</versions>
        <p>
          <a href="./repository.html">Source Repository</a>
        </p>
        <p>
          <a href="./license.html">Project License</a>
        </p>
        <p>
          <a href="./versioning.html">Version Numbering</a>
        </p>
        <p>
          <a href="./extensions.html">Extensions</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>Documentation</h1>
        <p>
          <a href="./getting-started.html">Getting Started</a>
        </p>
        <p>
          <a href="./cookbook.html">Cookbook</a>
        </p>
        <p>
          <a href="./cheat-sheet.html">Cheat Sheet</a>
        </p>
        <p>
          <a href="./javadoc.html">API Documentation</a>
        </p>
        <p>
          <a href="./articles.html">Articles and Papers</a>
        </p>
        <p>
          <a href="./jmock1.html">jMock 1 Documentation</a>
        </p>
        <p>
          <a href="http://www.mockobjects.com">About Mock Objects</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>User Support</h1>
        <p>
          <a href="./mailing-lists.html">Mailing Lists</a>
        </p>
        <p>
          <a href="http://www.musketeer-labs.com/">Training</a>
        </p>
        <p>
          <a href="https://github.com/jmock-developers/jmock-library/issues">Issue Tracker</a>
        </p>
        <p>
          <a href="./news-rss2.xml">News Feed (RSS 2.0)</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>Credits</h1>
        <p>
          <a href="./team.html">Development Team</a>
        </p>
        <p>
          <a href="http://www.github.com">Project hosted by Github</a>
        </p>
        <p>
          <a href="http://tango.freedesktop.org">Icons by the Tango Project</a>
        </p>
      </div>
    </div>
  </body>
</html>
