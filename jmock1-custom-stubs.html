<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:fn="http://www.w3.org/2005/xpath-functions">
  <head>
    <title>jMock - Custom Stubs</title>
    <link media="screen" rel="stylesheet" type="text/css" href="./jmock.css"/>
    <link media="print" rel="stylesheet" type="text/css" href="./print.css"/>
    <link rel="icon" type="image/png" href="./icon.png"/>
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <script type="text/javascript" src="prefs.js">
      
    </script>
  </head>
  <body onload="restorePreferredTestFramework()">
    <div id="banner">
      <a href="./index.html">
        <img id="logo" src="logo.png" alt="jMock"/>
      </a>
    </div>
    <div id="center" class="Content">
      <div id="content">
        <h1>jMock 1: Writing Custom Stubs</h1>
        <p>A mock object does two things: it tests that it receives the expected
    method invocations and it stubs the behaviour of those methods. Almost all
    methods can be stubbed in one of three basic ways: return nothing (a void
    method), return a result to the caller or throw an exception. Sometimes,
    however, you need to stub side effects of a method, such as a method that
    calls back to the caller through an object reference passed as one of its
    parameters. Luckily, jMock makes it easy to write custom stubs for methods
    with strange behaviours and keep your tests easy to read when you do
    so.</p>
        <p>Here's a simple example: we want to test a <code>NameCollector</code>
    object that collects the names of a collection <code>Named</code> objects.
    It will do so by passing a <code>List</code> to the
    <code>collectName</code> method of the named objects. The named objects
    implement <code>collectName</code> by addding their name to the list they
    receive. The <code>Named</code> interface is shown below:</p>
        <div class="Source Java">
          <pre>public interface Named {
    void collectName( List list );
}</pre>
        </div>
        <p>To test the behaviour of our object we will need to mock the
    <code>Named</code> interface, and in particular we need to stub the
    <em>side effect</em> of the <code>collectName</code> method. jMock
    provides stubs for returning values and throwing exceptions but we will
    have to write our own class to stub the side effect of the
    <code>Named</code> objects.</p>
        <p>To write a stub:</p>
        <ol>
      <li><p>Write a class that implements the <code>Stub</code> interface.
      Here's a stub that adds an element to a List received as the first
      argument of the method.</p> <div class="Source Java"> <pre>public class AddToListStub implements Stub
{
    Object element;

    public AddToListStub( Object element ) {
        this.element = element;
    }

    public StringBuffer describeTo( StringBuffer buffer ) {
        return buffer.append("adds &lt;"+element+"&gt; to a list");
    }

    public Object invoke( Invocation invocation ) throws Throwable {
        ((List)invocation.parameterValues.get(0)).add(element);
        return null;
    }
}</pre> </div></li>

      <li><p>Write a factory method in your tests class that instantiates your
      new stub class.</p> <div class="Source Java"> <pre>private Stub addListElement( Object newElement ) {
    return new AddToListStub(newElement);
}</pre> </div></li>

      <li><p>Call your factory method within the actual parameter list of the
      mock's <code>will</code> method.</p> <div class="Source Java"> <pre>Mock mockNamed = mock(Named.class);
String name = "name";

mockNamed.expects(once()).method("collectName").with(NOT_NULL)
    .will(addListElement(name));</pre> </div></li>
    </ol>
      </div>
    </div>
    <div id="navigation">
      <div class="MenuGroup">
        <h1>
          <a href="download.html">Software</a>
        </h1>
        <versions xmlns="">
  <h2 xmlns="http://www.w3.org/1999/xhtml">jMock 2 (Java 1.5+)</h2><ul xmlns="http://www.w3.org/1999/xhtml"><li><a href="./download.html">Unstable: 2.6.0-RC2</a></li><li><a href="./download.html">Stable: 2.5.1</a></li></ul>
  <h2 xmlns="http://www.w3.org/1999/xhtml">jMock 1 (Java 1.3+)</h2><ul xmlns="http://www.w3.org/1999/xhtml"><li><a href="./download.html">Stable: 1.2.0</a></li></ul>
</versions>
        <p>
          <a href="./repository.html">Source Repository</a>
        </p>
        <p>
          <a href="./license.html">Project License</a>
        </p>
        <p>
          <a href="./versioning.html">Version Numbering</a>
        </p>
        <p>
          <a href="./extensions.html">Extensions</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>Documentation</h1>
        <p>
          <a href="./getting-started.html">Getting Started</a>
        </p>
        <p>
          <a href="./cookbook.html">Cookbook</a>
        </p>
        <p>
          <a href="./cheat-sheet.html">Cheat Sheet</a>
        </p>
        <p>
          <a href="./javadoc.html">API Documentation</a>
        </p>
        <p>
          <a href="./articles.html">Articles and Papers</a>
        </p>
        <p>
          <a href="./jmock1.html">jMock 1 Documentation</a>
        </p>
        <p>
          <a href="http://www.mockobjects.com">About Mock Objects</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>User Support</h1>
        <p>
          <a href="./mailing-lists.html">Mailing Lists</a>
        </p>
        <p>
          <a href="http://www.musketeer-labs.com/">Training</a>
        </p>
        <p>
          <a href="http://jira.codehaus.org/secure/BrowseProject.jspa?id=10336">Issue Tracker</a>
        </p>
        <p>
          <a href="./news-rss2.xml">News Feed (RSS 2.0)</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>Credits</h1>
        <p>
          <a href="./team.html">Development Team</a>
        </p>
        <p>
          <a href="http://www.codehaus.org">Project hosted by Codehaus</a>
        </p>
        <p>
          <a href="http://tango.freedesktop.org">Icons by the Tango Project</a>
        </p>
      </div>
    </div>
  </body>
</html>
