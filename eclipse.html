<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:fn="http://www.w3.org/2005/xpath-functions">
  <head>
    <title>jMock - Mocking Classes in Eclipse Plug-in Tests</title>
    <link media="screen" rel="stylesheet" type="text/css" href="./jmock.css"/>
    <link media="print" rel="stylesheet" type="text/css" href="./print.css"/>
    <link rel="icon" type="image/png" href="./icon.png"/>
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <script type="text/javascript" src="prefs.js">
      
    </script>
  </head>
  <body onload="restorePreferredTestFramework()">
    <div id="banner">
      <a href="./index.html">
        <img id="logo" src="logo.png" alt="jMock"/>
      </a>
    </div>
    <div id="center" class="Content">
      <div id="content">
        <h1>Mocking Classes in Eclipse Plug-in Tests</h1>
        <p>by Ulli Hafner.</p>
        <p>Mocking classes in Eclipse plug-ins requires some extra work (mocking
interfaces works out of the box). Typically, an Eclipse application consists
of several source plug-ins. The unit tests of these plug-ins are also stored
in different plug-ins. E.g., if the main code of an application is stored in
<code>com.foo.core</code> then the tests are stored in the plug-in
<code>com.foo.core.tests</code>.</p>
        <p>Within Eclipse you have the possibility to start your tests as JUnit test
or plug-in tests. For Junit tests Eclipse simply calls the JUnit runner,
tests your class and reports the results. You can use jMock as a library on
your classpath without any additional configuration.</p>
        <p>However, when running tests as plug-in tests Eclipse starts the target
Eclipse platform, deploys your tests in this platform and starts these tests.
Eclipse loads each plug-in from the <a href="http://www.eclipsezone.com/articles/eclipse-vms/">OSGI classloader
mechanism</a><sup class="LinkFootnoteRef">1</sup>. Each plug-in will be loaded by an individual classloader. In
this case you cannot create mocks for classes that are part of another
plug-in out of the box. Since the classes to mock are loaded by a different
classloader jMock cannot access them (actually cglib does not see these
classes).</p>
        <p>In order to mock classes in other plug-ins you need to use the Eclipse
buddy declarations in your plug-ins. Basically, you need to add in the
MANIFEST of the plug-ins that contain the actual classes the following
statement: Eclipse-BuddyPolicy: registered. This statement instructs the
Eclipse class loader to let other plug-ins access these classes. In your
jMock test plug-in you need to add in the MANIFEST file the counterpart
statement "<code>Eclipse-RegisterBuddy: com.foo.plugin1,
com.foo.plugin2</code>". Now you can mock classes of the plug-ins
<code>com.foo.plugin1</code> and <code>com.foo.plugin2</code> in your test
cases.</p>
        <p/>
        <h2>Example MANIFEST of plug-in jmock.example</h2>
        <pre>Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Example Plug-in
Bundle-SymbolicName: jmock.example
Bundle-Version: 1.0.0
Bundle-Activator: jmock.example.Activator
Require-Bundle: org.eclipse.core.runtime
Eclipse-LazyStart: true
Export-Package: jmock.example
Eclipse-BuddyPolicy: registered</pre>
        <h2>Example MANIFEST of plug-in jmock.example.tests</h2>
        <pre>Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Tests Plug-in
Bundle-SymbolicName: jmock.example.tests
Bundle-Version: 1.0.0
Bundle-Activator: jmock.example.tests.Activator
Require-Bundle: org.eclipse.core.runtime, org.junit, jmock.example
Eclipse-LazyStart: true
Eclipse-RegisterBuddy: jmock.example
Bundle-ClassPath: ., lib/cglib-2.1_3-src.jar, lib/cglib-nodep-2.1_3.jar, lib/hamcrest-api-1.0.jar, lib/hamcrest-library-1.0.jar, lib/jmock-2.1.0.jar, lib/jmock-junit3-2.1.0.jar, lib/jmock-legacy-2.1.0.jar, lib/objenesis-1.0.jar</pre>
      </div>
      <div class="LinkFootnotes">
        <p class="LinkFootnotesHeader">Links:</p>
        <p>1.
	  				OSGI classloader
mechanism:
	  				
	  				http://www.eclipsezone.com/articles/eclipse-vms/</p>
      </div>
    </div>
    <div id="navigation">
      <div class="MenuGroup">
        <h1>
          <a href="download.html">Software</a>
        </h1>
        <versions xmlns="">
  <h2 xmlns="http://www.w3.org/1999/xhtml">jMock 2 (Java 1.6)</h2><ul xmlns="http://www.w3.org/1999/xhtml"><li><a href="./download.html">Stable: 2.6.1</a></li></ul>
  <h2 xmlns="http://www.w3.org/1999/xhtml">jMock 1 (Java 1.3+)</h2><ul xmlns="http://www.w3.org/1999/xhtml"><li><a href="./download.html">Stable: 1.2.0</a></li></ul>
</versions>
        <p>
          <a href="./repository.html">Source Repository</a>
        </p>
        <p>
          <a href="./license.html">Project License</a>
        </p>
        <p>
          <a href="./versioning.html">Version Numbering</a>
        </p>
        <p>
          <a href="./extensions.html">Extensions</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>Documentation</h1>
        <p>
          <a href="./getting-started.html">Getting Started</a>
        </p>
        <p>
          <a href="./cookbook.html">Cookbook</a>
        </p>
        <p>
          <a href="./cheat-sheet.html">Cheat Sheet</a>
        </p>
        <p>
          <a href="./javadoc.html">API Documentation</a>
        </p>
        <p>
          <a href="./articles.html">Articles and Papers</a>
        </p>
        <p>
          <a href="./jmock1.html">jMock 1 Documentation</a>
        </p>
        <p>
          <a href="http://www.mockobjects.com">About Mock Objects</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>User Support</h1>
        <p>
          <a href="./mailing-lists.html">Mailing Lists</a>
        </p>
        <p>
          <a href="http://www.musketeer-labs.com/">Training</a>
        </p>
        <p>
          <a href="https://github.com/jmock-developers/jmock-library/issues">Issue Tracker</a>
        </p>
        <p>
          <a href="./news-rss2.xml">News Feed (RSS 2.0)</a>
        </p>
      </div>
      <div class="MenuGroup">
        <h1>Credits</h1>
        <p>
          <a href="./team.html">Development Team</a>
        </p>
        <p>
          <a href="http://www.github.com">Project hosted by Github</a>
        </p>
        <p>
          <a href="http://tango.freedesktop.org">Icons by the Tango Project</a>
        </p>
      </div>
    </div>
  </body>
</html>
